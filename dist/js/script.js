document.addEventListener("touchstart",(function(){}),!0);const e=document.getElementById("radioSelect"),t=document.getElementById("player"),n=document.getElementById("loadingNoise"),o=document.getElementById("errorNoise"),s=document.getElementById("loadingMsg"),a=document.getElementById("errorMsg"),r=document.getElementById("prevButton"),i=document.getElementById("playButton"),c=document.getElementById("pauseButton"),l=document.getElementById("nextButton"),d=document.getElementById("posterImage");let u=!1,m=!1,p=null;function g(e,t=!1){return`https://res.cloudinary.com/adrianf/image/upload/c_scale,h_480,w_480/w_400,g_south_west,x_50,y_70,c_fit,l_text:arial_90:${e}/${t?"rhz6yy4btbqicjqhsy7a":"nndti4oybhdzggf8epvh"}`}d.querySelector("img").src=g("Coji Radio Player");const v=()=>{const n=e.options[e.selectedIndex].text;"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:m?`Se încarcă...${n}`:u?`Eroare la încărcarea ${n}`:n,artist:`Coji Radio Player | ${n}`,artwork:[{src:g(m?"Se încarcă...":u?"Eroare":n,!(!n||m||u))}]}),navigator.mediaSession.setActionHandler("previoustrack",(()=>{console.log("prev by media session"),h()})),navigator.mediaSession.setActionHandler("nexttrack",(()=>{console.log("next by media session"),L()})),navigator.mediaSession.setActionHandler("pause",(()=>{console.log("paused by media session"),t.pause()})),navigator.mediaSession.setActionHandler("play",(()=>{console.log("played by media session"),t.play()}))),d.querySelector("img").src=g(m?"Se încarcă...":u?"Eroare":n,!(!n||m||u)),document.title=`${m?"⏳":""} ${u?"❤️‍🩹":""} ${m||u?"":"🔴"} ${m?`Se incarca ${n}`:u?"Eroare":n}`,s.innerText=m?`Se incarca ${n}...`:""};function y(e){let t=e.querySelector("source").src,s=!1;const a={};return a.src=t,a.play=()=>{s||(console.log("Play audio",{htmlSrc:e.src,instanceSrc:a.src}),e.src=a.src,s=!0,e.play().catch((e=>{"AbortError"!==e.name&&console.error("Error playing audio:",e),s=!1})),e!==n&&e!==o||(e.volume=.3))},a.stop=()=>{s&&(console.log("Stop audio",{htmlSrc:e.src,instanceSrc:a.src}),e.pause(),e.src="",s=!1)},a}const E=y(n),I=y(o),S=n=>{console.log("playRadio",{index:n,value:e.value}),e.selectedIndex=n,m=!0,u=!1,v(),I.stop(),E.play(),s.classList.remove("invisible"),a.classList.add("invisible"),t.pause(),t.src=e.value,t.load(),t.play().then((()=>{m=!1,u=!1,s.classList.add("invisible"),a.classList.add("invisible"),E.stop(),v()})).catch((e=>{"AbortError"!==e.name&&(console.log("Error playing radio:",e),m=!1,u=!0,s.classList.add("invisible"),a.classList.remove("invisible"),E.stop(),I.play(),v())}))};e.addEventListener("change",(n=>{n.target.value?S(e.selectedIndex):(t.pause(),t.src="")}));const h=()=>{console.log("prevRadio"),S(e.selectedIndex>1?e.selectedIndex-1:e.options.length-1)},L=()=>{console.log("nextRadio"),S(e.selectedIndex<e.options.length-1?e.selectedIndex+1:1)};window.electronAPI&&(window.electronAPI.onMediaControl((e=>{console.log("Comandă media primită:",e),"playpause"===e?t.paused?t.play():t.pause():"next"===e?(console.log("Next track (nu este implementat)"),L()):"previous"===e&&(console.log("Previous track (nu este implementat)"),h())})),document.addEventListener("DOMContentLoaded",(()=>{function e(){window.electronAPI.updatePlaybackState(!t.paused)}t.addEventListener("play",e),t.addEventListener("pause",e)}))),i.addEventListener("click",(()=>{t.paused&&(0===e.selectedIndex?S(1):t.play())})),c.addEventListener("click",(()=>{t.pause()})),t.addEventListener("play",(n=>{console.log("Event play",n),i.classList.add("hidden"),c.classList.remove("hidden");const o=performance.now()-p;p&&o>2e3&&(console.log("Restart radio after pause",{timeDiff:o,e:n}),t.pause(),t.src="",S(e.selectedIndex)),p=null})),t.addEventListener("pause",(()=>{console.log("Event pause"),i.classList.remove("hidden"),c.classList.add("hidden"),p=performance.now()})),r.addEventListener("click",h),l.addEventListener("click",L);new Worker("./js/keepAlive.js").onmessage=()=>{console.log("Mențin conexiunea activă...")},"serviceWorker"in navigator&&navigator.serviceWorker.register("./js/sw.js").then((e=>console.log("Service Worker registered!"))).catch((e=>console.error("Service Worker registration failed:",e)));